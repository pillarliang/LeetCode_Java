 ##1. HTTP
    1. HTTP格式
        1. 请求HTTP
        
        请求行： 方法 + URI + HTTP版本号
        消息头： 日期、客户端支持的数据类型、语言、压缩格式、客户端和服务器的软件名称和版本、数据有效期和最后更新时间等。
        <空行>
        消息体
        
        2. 响应HTTP
        
        状态行：状态码和响应短语
        消息头
        消息体

HTTP并不能发送到服务器，需要通过查询域名的IP地址， 各公司IP地址都是通过TCP/IP思路设计
##2. TCP/IP基本设计思路
    1. IP地址：是一串32比特的数字
    因为造成分布不均，所以加入子网掩码
    
    2. 浏览器向最近DNS服务器发送查询请求，将网址查为IP地址。解析器实际上是一段程序，它包含在操作系统的 Socket 库中
    3. DNS服务器是分散的，一台找不到会寻找另一台
        首先，将负责管理下级域的 DNS 服务器的 IP 地址注册到它们的上级 DNS 服务器中，然后上级 DNS 服务器的 IP 地址再注册到更上一级的 DNS 服务器中，以此类推。
        除此之外还需要完成另一项工作，那就是将根域的 DNS 服务器信息保存在互联网中所有的 DNS 服务器中。
    4. 一个最近的服务器没有该IP，它就会从根服务器开始从上往下查找。有时候并不需要从最上级的根域开始查找，因为 DNS 服务器有一
    个缓存功能，可以记住之前查询过的域名。如果要查询的域名和相关信息已经在缓存中，那么就可以直接返回响应，接下来的查询可以从缓存的位置开始向下进行。
    
    找到IP地址，就可以通过计算机的协议栈（也在sockey库）发送数据（HTTP）信息了
    5. 客户端和服务器建立--套接字。 类似于管道去传输数据
    首先，服务器一方先创建套接字，然后等待客户端向该套接字连接管道。当服务器进入等待状态时，客户端就可以连接管道了

接下来分为四个阶段，
创建套接字，
连接服务器，
收发数据，
从服务器断开连接并删除套接字， IP与以太网的包
收发操作，UDP协议


##应用程序创建套接字
    1. 协议栈内部
        应用程序的下面是 Socket 库，其中包括解析器，解析器用来向 DNS服务器发出查询，它的工作过程我们在第 1 章已经介绍过了。
        再下面就是操作系统内部了，其中包括协议栈。协议栈的上半部分有两块，分别是负责用 TCP 协议收发数据的部分和负责用 UDP 协议收发数据的部分，它们会接受应用程序的委托执行收发数据的操作。
        下面一半是用 IP 协议控制网络包收发操作的部分。在互联网上传送数据时，数据会被切分成一个一个的网络包，而将网络包发送给通信对象的操作就是由 IP 来负责的。
    
    2. 套接字定义：https://blog.csdn.net/wangluqinglxq/article/details/38402759
        在协议栈内部有一块用于存放控制信息的内存空间，这里记录了用于
        控制通信操作的控制信息，例如通信对象的 IP 地址、端口号、通信操作的
        进行状态等。本来套接字就只是一个概念而已，并不存在实体。

##连接服务器
    1. 应用程序从Socket库调用connnet方法，该方法里面包含了服务器IP地址和端口号。该信息传递给TCP模块，之后该TCP模块会与服务器TCP模块交换信息：
    首先TCP创建信息头部，然后委托IP模块发送，置SYN为1，表示发送出去了。服务器拿到后，找到对应的套接字。之后服务器TCP模块委托IP返回响应，将ACK控制位设置为1.
    用户端收到后，如果SYN为1表示已经连接成功，这时会向套接字中写入服务器的 IP 地址、端口号等信息。客户端也需要将 ACK 比特设置为 1 并发回服务器，告诉服务器刚才的响应包已经收到。

##收发数据
    1. 应用程序调用write将要发送的数据交给协议栈
    2. 协议栈只关心数据的长度
    3. 协议栈将数据存放在内部缓冲区，等待下一段数据。一次将多少数据交给协议栈是由应用程序自行决定的，协议栈并不能控制这一行为
    4. 之后：
        1. 客户端计算到服务器方向通信相关的序号初始值，并将这个值发送给服务器，服务器会通过这个初始值计算出 ACK 号并返回给客户端，初始值有可能在通信过程中丢失，
        因此当服务器收到初始值后需要返回 ACK 号作为确认
        2. 服务器端也要向客户端发送数据，所以服务器端重复1操作
        3. 接下来进入数据收发阶段： 每次发送数据给对方，对方会回复一个ACK号表示数据已经接收
        4. 如果没有等到ACK号就重发
    5. 等待多久合适呢？TCP 采用了动态调整等待时间的方法
    
    ACK等待时间
    1. TCP 发送数据过程持续测量 ACK 号返回时间，返回变慢，则相应延长等待时间；
    2. 发送一个数据，等待ACK，什么都不做太浪费了。采用滑动窗口方式，来管理数据发送和 ACK 号的操作。
    滑动窗口：在发送一个包之后，不等待 ACK 号返回，而是直接发送后续的一系列包。
    
    滑动窗口：
    1. 接收方接收到数据放入缓冲区，然后处理。但是太多会处理不过来
    2. 怎么解决？ 他会告诉发送发他的缓冲区能接受多少数据。 （更新窗口）

![](../Image/滑动窗口.png)
    
    3. ack和更新窗口在一个包里面
        
##断开连接
    1. 完成数据发送的一方会发起断开连接，以服务器为例
    2. 服务器调用socket库的close程序，协议栈生成断开信息的TCP头部，将FIN比特置为1，委托IP模块发送给客户端
    3. 客户端收到FIN为1的TCP头部后，客户端协议栈会将自己的套接字标记为断开操作状态，返回服务器一个ACK号确认收到。然后
    协议栈等待应用程序从缓冲区读取数据，并告知应用程序，服务器的数据已经全部收到。
    客户端调用close来结束数据收发操作，生成FIN比特为1的TCP包，委托IP模块发送给服务器。
    4. 服务器返回ACK号
    
    5. 等待一段时间删除套接字。服务器不会马上删除套接字，因为一直没等到ACK号，会重复发TCP包。
  
  
下面介绍包    
    
##包
    1. 包由头部和数据两部分构成：
        头部：目的地等信息
        
##UDP
    1. 是一个面向无连接的协议
    2. 传输数据时，不需要建立连接，不管对方端服务是否启动，直接将数据、数据源和目的地都封装在数据包中，直接发送。
    3. 每个数据包的大小限制在64k以内